---
title: "Homework 2"
author: "Jenn Lewis, Karlena Ochoa, Katie Denning"
date: "2/20/2019"
output: html_document
---

```{r setup}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

library(gghighlight)
library(tidyverse)
library(rio)
library(here)
library(ggrepel)
library(magrittr)
library(lubridate)


data <- import("https://www.denvergov.org/media/gis/DataCatalog/crime/csv/crime.csv") %>%
  janitor::clean_names()

glimpse(data)

```




```{r Question 1 Replicate Plot}

#Things I Can't Figure out:  I can't figure out how to clean up the names of the offense categories easily.
#Not sure why his graph doesn't have traffic accidents


crime_percent <- data %>%
  count(offense_category_id) %>%
  mutate(Percent = (n/sum(n)),
         prop_se = (sqrt((Percent*(1-Percent)) / n))) 

crime_percent %>%
 ggplot(aes(fct_reorder(offense_category_id, Percent), Percent)) +
  geom_errorbar(aes(ymin = Percent + qnorm(0.025)*prop_se,
                    ymax = Percent + qnorm(0.975)*prop_se)) +
  geom_point(color = "cornflower blue") +
  coord_flip() +
  theme_minimal() +
  scale_y_continuous(labels = scales::percent, limits = c(NA, .3)) +
  labs(x = "",
       title = "Crimes in Denver",
       caption = "Denver Crime Data Distributed via Kaggle
       https://www.kaggle.com/paultimothymooney/denver-crime-data")

```


```{r Question 2 Same Relationship Different Uncertainty Visualization}



```


```{r Question 3 Reproduce plot}

# need crime proortion by district and year. Add error bars to proportions. Extract year. 

df3 <- data %>% 
  select("reported_date", "district_id", "offense_type_id", "offense_category_id") %>% 
  separate(reported_date, c("year", "delete"), sep = " ") %>% 
  select(-"delete") %>% 
  separate(year, c("month", "day", "year"), sep = "/") %>% 
  select(-"month", -"day")
  

df3 %<>% 
  group_by(year, district_id) %>%
  count(offense_category_id) %>%
  mutate(prop = (n/sum(n))) %>% 
  group_by(year, district_id) %>% 
  summarize(prop = mean(prop))


ggplot(df3, aes(as.factor(district_id), prop)) +
  geom_col(aes(fill = as.factor(district_id))) +
  coord_flip() +
  theme_minimal() +
  facet_wrap(~year) +
  labs(x = "Proportion",
       y = "District",
       title = "Crimes in Denver",
       caption = "Denver Crime Data Distributed via Kaggle
       https://www.kaggle.com/paultimothymooney/denver-crime-data") +
  theme(legend.position = "none")

#proportions are not correct yet, and error bars need to be added. 
  

```



```{r Question 4 Dot Plot }

```


```{r Question 5 Reproduce Table }

```

